{% extends "internal/base.html" %}
{% load static %}

{% block header_name %}
    <div id="status" style="text-align: center; margin-top: 3vh; color: rgb(143, 6, 197);"></div>
    <div class="header-name">{{ message }}</div>
    <div id="header" class="header-desc">{{ base_url }}/{{ hash }}</div>
    {% endblock %}
    
    {% block content %}
    <div class="form-wrapper">
        <form enctype="multipart/form-data" method="post">
            {% csrf_token %}
            
            <button id="btn" class="form-btn">Send</button>
        </form>
    </div>
    
    <script>
        // handler of button submit
        document.getElementById("btn").addEventListener('click',function(e){
            e.preventDefault();

            const data = {
                hash: "{{ hash }}",
                url: document.getElementById('header').textContent,
            };

            fetch('{% url "api-bot_send" %}', {
                method:'POST',
                headers:{
                    'Content-Type':'application/json', 
                    'X-CSRFToken':'{{ csrf_token }}',
                    'X-Requested-With':'XMLHttpRequest'
                },
                body: JSON.stringify(data),
                mode:'cors',
                cache:'default',
                credentials:'include'      
            }).then((response) => response.json())
            .then((result) => {
                header = document.getElementById('status')
                header.innerHTML = result['message'];
            })
            .catch((err) => {
                header = document.getElementById('status')
                header.innerHTML = "Error. Try Later...";
                console.log('error:', err)
            })
        }, false);
    </script>
{% endblock %}